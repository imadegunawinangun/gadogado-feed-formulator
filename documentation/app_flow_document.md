# App Flow Document

## Onboarding and Sign-In/Sign-Up

When a new user first arrives, they land on the public homepage at “/”. This page briefly describes the feed formulation service and offers two clear buttons labeled “Sign In” and “Sign Up.” If the user clicks “Sign Up,” they are taken to “/sign-up,” where they enter a valid email address, choose a password, and confirm it. Once they submit the form, the system uses Better Auth (backed by Supabase if configured) to create the account and store the user’s session. The user receives a confirmation message and is automatically redirected to the dashboard. If the user forgets their password, a “Forgot Password?” link on the sign-in form leads to “/reset-password.” There they enter their email address, receive a reset link, and follow that link to set a new password. After resetting, they return to “/sign-in,” enter their updated credentials, and gain access. Signing out is handled by clicking the profile icon in the header and selecting “Sign Out,” which clears the session and returns the user to the public homepage.

## Main Dashboard or Home Page

After successful login, the user lands on “/dashboard,” which is the main hub of the application. A vertical sidebar on the left lists the primary sections: Formulation, Ingredients, Animals, and Reports. At the top of the page, a header shows the current page title, a theme toggle for light or dark mode, and a profile menu. The center area displays a welcome banner that highlights quick actions, such as creating a new formulation or viewing recent activity. From this dashboard, the user can click any item in the sidebar to navigate deeper into specific modules or use the profile menu to access settings and account management. The layout remains consistent across all pages so that navigation feels intuitive.

## Detailed Feature Flows and Page Transitions

When the user selects “Ingredients” from the sidebar, they are taken to “/dashboard/ingredients.” Here a table lists all saved ingredients, showing name, nutritional values, and cost per unit. A button labeled “Add Ingredient” appears above the table. Clicking it brings the user to “/dashboard/ingredients/new,” where they fill out a form with fields for ingredient name, protein, fat, fiber content, and price. Submitting this form calls the API and returns the user to the ingredient list, which now includes the new entry. If the user clicks an existing ingredient row, they navigate to “/dashboard/ingredients/[id]/edit” to update or delete that entry.

Choosing “Animals” in the sidebar directs the user to “/dashboard/animals.” On this page, they see a list of animal profiles with columns for species, age group, and production stage. A “Create Profile” button sends them to “/dashboard/animals/new,” where they enter profile details and save. Selecting a profile moves them to “/dashboard/animals/[id]” for viewing or editing, with options to update production stage or remove the profile entirely.

Clicking “Formulation” in the sidebar opens “/dashboard/formulation.” The user sees a form that prompts them to choose an animal profile from a dropdown, select a target production stage, and set constraints such as minimum protein and maximum cost. They also see a list of currently available ingredients with checkboxes. After making selections, the user taps “Run Formulation.” Behind the scenes, a server action in Next.js calls the optimization engine in the “lib” directory, performs the linear programming calculation, and returns results. The page then updates to display a summary of the recommended feed blend, breaking down each ingredient’s percentage and showing the total cost per unit.

Within the formulation result view, charts and tables refresh in real time to illustrate nutritional values versus targets. Users can click “Export CSV” or “Download PDF” to retrieve a report file. If the user wishes to save this formulation for later, they click “Save Formulation,” which stores the recipe in the database and makes it accessible under the “Reports” section.

## Settings and Account Management

From the profile menu in the top header, the user can choose “Account Settings” to arrive at “/settings.” This page has two tabs: Profile and Preferences. Under Profile, the user edits their display name, email address, and password. Under Preferences, they toggle notification settings for email alerts when a new formulation runs or when an ingredient update occurs. If billing or subscription features are enabled, a third tab labeled “Subscription” lists plan details, allows plan upgrades, and displays payment history. Once changes are saved, a confirmation toast appears and the user can click “Back to Dashboard” to resume their work.

## Error States and Alternate Paths

If a user enters invalid credentials at sign-in, a red banner appears above the form explaining the issue and prompting retry. During sign-up, if the password is too weak or the email already exists, inline messages appear next to the corresponding fields. While filling ingredient or animal forms, leaving a required field blank triggers an inline error message and disables the submit button until corrected. If a network issue occurs—such as the server being unreachable—a full-page fallback shows a “Network Error” message with a “Retry” button that reattempts the failed request. Attempting to access any protected route without a valid session redirects the user to the “/sign-in” page. If the user tries to navigate to an edit page for an entity that does not exist or belongs to another user, they are shown a “404 Not Found” or “Access Denied” page, respectively, with a link back to the dashboard.

## Conclusion and Overall App Journey

In summary, a new user begins by landing on the public homepage, signs up or signs in, and is taken to a protected dashboard. From there, they manage ingredients, animal profiles, and run feed formulations. All major features are accessible via the sidebar and header menus. They can adjust account details, preferences, and, if available, subscription plans in the settings. Along the way, clear error messages and fallback pages ensure a smooth experience. The typical end goal is to create, analyze, and export optimized feed formulations, while conveniently managing all related data in one cohesive, user-friendly application.